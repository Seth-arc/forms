<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AidData Scholarship Application</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="assets/aiddata_icon.ico">
    
    <!-- EmailJS -->
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js"></script>
    
    <!-- Load Global South Countries Data -->
    <script>
        // Global South Countries Data (embedded for offline functionality)
        // Complete list of 125 eligible countries from global_south_countries.json
        const globalSouthData = {
            "africa": ["Algeria", "Angola", "Benin", "Botswana", "Burkina Faso", "Burundi", "Cabo Verde", "Cameroon", "Central African Republic", "Chad", "Comoros", "Democratic Republic of the Congo", "Republic of the Congo", "Côte d'Ivoire", "Djibouti", "Egypt", "Equatorial Guinea", "Eritrea", "Eswatini", "Ethiopia", "Gabon", "Gambia", "Ghana", "Guinea", "Guinea-Bissau", "Kenya", "Lesotho", "Liberia", "Libya", "Madagascar", "Malawi", "Mali", "Mauritania", "Mauritius", "Morocco", "Mozambique", "Namibia", "Niger", "Nigeria", "Rwanda", "São Tomé and Príncipe", "Senegal", "Seychelles", "Sierra Leone", "Somalia", "South Africa", "South Sudan", "Sudan", "Tanzania", "Togo", "Tunisia", "Uganda", "Zambia"],
            "asia": ["Bangladesh", "Bhutan", "Brunei", "Cambodia", "China", "India", "Indonesia", "Iraq", "Jordan", "Kazakhstan", "Kyrgyzstan", "Laos", "Lebanon", "Malaysia", "Maldives", "Mongolia", "Nepal", "Oman", "Pakistan", "Philippines", "Qatar", "Saudi Arabia", "Sri Lanka", "Tajikistan", "Thailand", "Timor-Leste", "Turkmenistan", "United Arab Emirates", "Uzbekistan", "Vietnam", "Yemen"],
            "latin_america_caribbean": ["Antigua and Barbuda", "Argentina", "Bahamas", "Barbados", "Belize", "Bolivia", "Brazil", "Chile", "Colombia", "Costa Rica", "Dominica", "Dominican Republic", "Ecuador", "El Salvador", "Grenada", "Guatemala", "Guyana", "Haiti", "Honduras", "Jamaica", "Mexico", "Panama", "Paraguay", "Peru", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Suriname", "Trinidad and Tobago", "Uruguay"],
            "oceania": ["Fiji", "Kiribati", "Marshall Islands", "Micronesia", "Nauru", "Palau", "Papua New Guinea", "Samoa", "Solomon Islands", "Tonga", "Tuvalu", "Vanuatu"]
        };
        
        // Get all Global South countries as a flat array
        const allGlobalSouthCountries = [
            ...globalSouthData.africa,
            ...globalSouthData.asia,
            ...globalSouthData.latin_america_caribbean,
            ...globalSouthData.oceania
        ];
    </script>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #2c3e50;
            background-color: #f8f9fa;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background-color: #ffffff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            flex: 1;
        }

        /* Header */
        .header {
            padding: 30px 30px 20px 30px;
            background-color: #ffffff;
        }

        .logo {
            height: 35px;
            width: auto;
        }

        /* Main Content */
        .main-content {
            padding: 0 30px 40px 30px;
            flex: 1;
        }

        .page-title {
            text-align: center;
            margin-bottom: 40px;
        }

        .page-title h1 {
            color: #115740;
            font-size: 36px;
            font-weight: 300;
            margin-bottom: 15px;
            letter-spacing: -0.5px;
        }

        .divider {
            width: 60px;
            height: 2px;
            background-color: #115740;
            margin: 0 auto 20px auto;
            opacity: 0.3;
        }

        .page-title p {
            font-size: 16px;
            color: #555;
            max-width: 500px;
            margin: 0 auto;
            font-weight: 300;
        }

        /* Form Styles */
        .form-container {
            background-color: #ffffff;
            border: 1px solid #e9ecef;
            border-radius: 12px;
            padding: 40px;
            margin-bottom: 30px;
        }

        .form-section {
            margin-bottom: 40px;
        }

        .form-section:last-child {
            margin-bottom: 0;
        }

        .section-title {
            color: #115740;
            font-size: 20px;
            font-weight: 500;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 1px solid #e9ecef;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-row {
            display: flex;
            gap: 20px;
            margin-bottom: 25px;
        }

        .form-col {
            flex: 1;
        }

        label {
            display: block;
            margin-bottom: 8px;
            color: #2c3e50;
            font-weight: 500;
            font-size: 14px;
        }

        .required {
            color: #e74c3c;
        }

        input[type="text"],
        input[type="email"],
        input[type="tel"],
        input[type="date"],
        input[type="number"],
        select,
        textarea {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 14px;
            font-family: inherit;
            transition: border-color 0.3s ease;
            background-color: #ffffff;
        }

        input:focus,
        select:focus,
        textarea:focus {
            outline: none;
            border-color: #115740;
            box-shadow: 0 0 0 2px rgba(17, 87, 64, 0.1);
        }

        textarea {
            resize: vertical;
            min-height: 120px;
        }

        select {
            cursor: pointer;
        }

        .checkbox-group,
        .radio-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .checkbox-item,
        .radio-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
        }

        input[type="checkbox"],
        input[type="radio"] {
            width: auto;
            margin: 4px 0 0 0;
            flex-shrink: 0;
        }

        .checkbox-item label,
        .radio-item label {
            margin: 0;
            cursor: pointer;
            font-weight: 400;
            line-height: 1.5;
        }

        /* Submit Button */
        .submit-container {
            text-align: center;
            padding-top: 30px;
            border-top: 1px solid #e9ecef;
        }

        .submit-btn {
            background-color: #115740;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 200px;
        }

        .submit-btn:hover {
            background-color: #0d4530;
            transform: translateY(-1px);
        }

        .submit-btn:active {
            transform: translateY(0);
        }

        .submit-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Loading and Success States */
        .loading {
            display: none;
            margin-top: 15px;
            color: #666;
            font-style: italic;
        }

        .success-message {
            display: none;
            background-color: #d4edda;
            color: #155724;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            border: 1px solid #c3e6cb;
        }

        .error-message {
            display: none;
            background-color: #f8d7da;
            color: #721c24;
            padding: 15px;
            border-radius: 6px;
            margin-top: 20px;
            border: 1px solid #f5c6cb;
        }

        /* Footer */
        .footer {
            background-color: #115740;
            padding: 25px 30px;
            text-align: center;
            color: white;
            margin-top: auto;
        }

        .footer p {
            margin-bottom: 10px;
            font-size: 14px;
        }

        .footer a {
            color: #C8A882;
            text-decoration: underline;
        }

        .footer-divider {
            width: 100%;
            height: 1px;
            background-color: rgba(255,255,255,0.3);
            margin: 20px 0;
        }

        .wm-logo {
            height: 60px;
            width: auto;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .container {
                margin: 0;
            }

            .main-content,
            .header {
                padding-left: 15px;
                padding-right: 15px;
            }

            .form-container,
            .verification-section {
                padding: 20px;
                margin: 20px 0;
            }

            .form-row {
                flex-direction: column;
                gap: 0;
            }

            .page-title h1 {
                font-size: 28px;
            }

            .page-title p {
                font-size: 14px;
                padding: 0 10px;
            }

            .submit-btn,
            .continue-btn,
            .back-btn {
                width: 100%;
                margin: 15px 0;
            }

            .verification-btn {
                margin-top: 10px;
                width: 100%;
            }

            .verification-input {
                flex-direction: column;
                gap: 10px;
                align-items: stretch;
            }

            .scholarship-options {
                grid-template-columns: 1fr;
                gap: 15px;
                padding: 0 10px;
            }

            .scholarship-option {
                padding: 20px 15px;
            }

            .option-title {
                font-size: 18px;
            }

            .option-description {
                font-size: 13px;
            }

            .option-requirements {
                font-size: 12px;
                padding: 12px;
            }

            .verification-title {
                font-size: 16px;
            }

            .section-title {
                font-size: 18px;
            }

            .selection-title {
                font-size: 20px;
                margin-bottom: 20px;
            }

            .status-message {
                font-size: 13px;
                padding: 12px;
            }

            .location-info {
                flex-direction: column;
                align-items: flex-start;
                text-align: left;
            }

            .footer {
                padding: 20px 15px;
            }

            .footer p {
                font-size: 13px;
            }

            .wm-logo {
                height: 50px;
            }
        }

        @media (max-width: 480px) {
            .main-content,
            .header {
                padding-left: 10px;
                padding-right: 10px;
            }

            .page-title h1 {
                font-size: 24px;
            }

            .form-container,
            .verification-section {
                padding: 15px;
                border-radius: 8px;
            }

            .scholarship-option {
                padding: 15px 12px;
            }

            .option-title {
                font-size: 16px;
                margin-bottom: 8px;
            }

            .option-description {
                font-size: 12px;
                margin-bottom: 12px;
            }

            .option-requirements {
                font-size: 11px;
                padding: 10px;
            }

            .verification-title {
                font-size: 15px;
            }

            .section-title {
                font-size: 16px;
            }

            .selection-title {
                font-size: 18px;
            }

            input[type="text"],
            input[type="email"],
            input[type="tel"],
            input[type="date"],
            input[type="number"],
            select,
            textarea {
                padding: 10px 12px;
                font-size: 14px;
            }

            .verification-btn {
                padding: 10px 15px;
                font-size: 13px;
            }

            .submit-btn,
            .continue-btn,
            .back-btn {
                padding: 12px 20px;
                font-size: 14px;
            }

            .footer {
                padding: 15px 10px;
            }

            .wm-logo {
                height: 45px;
            }
        }

        @media (max-width: 360px) {
            .scholarship-options {
                padding: 0 5px;
            }

            .scholarship-option {
                padding: 12px 10px;
            }

            .page-title h1 {
                font-size: 20px;
            }

            .selection-title {
                font-size: 16px;
            }

            .option-title {
                font-size: 15px;
            }

            .form-container,
            .verification-section {
                padding: 12px;
            }
        }

        /* Form Validation Styles */
        .invalid {
            border-color: #e74c3c !important;
            box-shadow: 0 0 0 2px rgba(231, 76, 60, 0.1) !important;
        }

        .error-text {
            color: #e74c3c;
            font-size: 12px;
            margin-top: 5px;
            display: none;
        }

        /* Scholarship Selection Styles */
        .scholarship-selection {
            text-align: center;
            margin-bottom: 40px;
        }

        .selection-title {
            color: #115740;
            font-size: 24px;
            font-weight: 400;
            margin-bottom: 30px;
        }

        .scholarship-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            max-width: 700px;
            margin: 0 auto;
        }

        .scholarship-option {
            background-color: #ffffff;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 30px 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .scholarship-option:hover {
            border-color: #115740;
            box-shadow: 0 4px 12px rgba(17, 87, 64, 0.15);
            transform: translateY(-2px);
        }

        .scholarship-option.selected {
            border-color: #115740;
            background-color: #f8fcfa;
            box-shadow: 0 4px 12px rgba(17, 87, 64, 0.2);
        }



        .option-title {
            color: #115740;
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .option-description {
            color: #666;
            font-size: 14px;
            line-height: 1.5;
            margin-bottom: 15px;
        }

        .option-requirements {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 6px;
            font-size: 13px;
            color: #555;
        }

        /* Verification Sections */
        .verification-section {
            display: none;
            background-color: #fcfcfc;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 25px;
            margin: 30px 0;
        }

        .verification-section.active {
            display: block;
        }

        .verification-title {
            color: #115740;
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .verification-step {
            margin-bottom: 20px;
        }

        .step-label {
            font-weight: 500;
            margin-bottom: 8px;
            color: #2c3e50;
        }

        .verification-input {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .verification-btn {
            background-color: #115740;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            white-space: nowrap;
        }

        .verification-btn:hover {
            background-color: #0d4530;
        }

        .verification-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }

        .status-message {
            padding: 12px;
            border-radius: 6px;
            margin-top: 15px;
            font-size: 14px;
        }

        .status-success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }

        .status-error {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }

        .status-warning {
            background-color: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }

        .status-info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }

        /* Location Verification */
        .location-info {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 6px;
            margin-top: 15px;
        }



        .hidden {
            display: none !important;
        }

        /* Continue Button */
        .continue-btn {
            background-color: #115740;
            color: white;
            padding: 15px 40px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            margin: 30px auto 0;
            display: block;
            min-width: 200px;
            transition: all 0.3s ease;
        }

        .continue-btn:hover {
            background-color: #0d4530;
            transform: translateY(-1px);
        }

        .continue-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        /* Back Button */
        .back-btn {
            background-color: transparent;
            color: #115740;
            border: 2px solid #115740;
            padding: 12px 30px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            margin: 15px auto 0;
            display: block;
            min-width: 160px;
            transition: all 0.3s ease;
        }

        .back-btn:hover {
            background-color: #115740;
            color: white;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <a href="https://aiddata.org">
                <img src="https://raw.githubusercontent.com/Seth-arc/scorms/main/Course_thumbnails/5e3c81fee74fc1743cc5f355_AidData_Logo--full_color.png" alt="AidData" class="logo" />
            </a>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <!-- Page Title -->
            <div class="page-title">
                <h1>Scholarship Application</h1>
                <div class="divider"></div>
                <p>Apply to join our Navigating Global Development Finance course. We offer two scholarship programs for eligible participants.</p>
            </div>

            <!-- Scholarship Selection -->
            <div id="scholarshipSelection" class="scholarship-selection">
                <h3 class="selection-title">Choose Your Scholarship Type</h3>
                <div class="scholarship-options">
                    <!-- W&M Affiliation Scholarship -->
                    <div class="scholarship-option" data-type="wm">
                        <div class="option-title">W&M Affiliation Scholarship</div>
                        <div class="option-description">
                            For current and former members of the William & Mary community including alumni, staff, faculty, and students.
                        </div>
                        <div class="option-requirements">
                            <strong>Requirements:</strong><br>
                            Verification with valid wm.edu email address required.
                            
                        </div>
                    </div>

                    <!-- Global South Scholarship -->
                    <div class="scholarship-option" data-type="global-south">
                        <div class="option-title">Global South Scholarship</div>
                        <div class="option-description">
                            For individuals residing and working/studying in any of the 125 eligible Global South countries.
                        </div>
                        <div class="option-requirements">
                            <strong>Requirements:</strong><br>
                            Location verification required with VPN usage not permitted.
                            
                        </div>
                    </div>
                </div>
            </div>

            <!-- W&M Email Verification -->
            <div id="wmVerification" class="verification-section">
                <h3 class="verification-title">W&M Email Verification</h3>
                <div class="verification-step">
                    <div class="step-label">Step 1: Enter your W&M email address</div>
                    <div class="verification-input">
                        <input type="email" id="wmEmail" placeholder="your.email@wm.edu" style="flex: 1;">
                        <button type="button" id="sendCodeBtn" class="verification-btn">Send Code</button>
                    </div>
                    <div id="wmEmailStatus"></div>
                </div>
                
                <div class="verification-step" id="codeVerificationStep" style="display: none;">
                    <div class="step-label">Step 2: Enter the verification code sent to your email</div>
                    <div class="verification-input">
                        <input type="text" id="verificationCode" placeholder="Enter 6-digit code" maxlength="6" style="flex: 1;">
                        <button type="button" id="verifyCodeBtn" class="verification-btn">Verify Code</button>
                    </div>
                    <div id="codeStatus"></div>
                </div>
                
                <button type="button" id="continueWMBtn" class="continue-btn" style="display: none;">Continue to Application</button>
                <button type="button" id="backFromWMBtn" class="back-btn">Back to Scholarship Selection</button>
            </div>

            <!-- Global South Location Verification -->
            <div id="globalSouthVerification" class="verification-section">
                <h3 class="verification-title">Location Verification</h3>
                <div class="verification-step">
                    <div class="step-label">Verifying your location...</div>
                    <div id="locationCheckStatus">
                        <div class="status-message status-info">
                            <strong>Checking your location...</strong><br>
                            Please wait while we verify your geographic location and check for VPN usage.
                        </div>
                    </div>
                </div>
                
                <div id="locationResults" style="display: none;">
                    <div class="location-info">
                        <div>
                            <strong>Detected Location:</strong><br>
                            <span id="detectedCountry">Loading...</span><br>
                            <span id="detectedCity">Loading...</span>
                        </div>
                    </div>
                </div>
                
                <button type="button" id="continueGSBtn" class="continue-btn" style="display: none;">Continue to Application</button>
                <button type="button" id="backFromGSBtn" class="back-btn">Back to Scholarship Selection</button>
            </div>

            <!-- Application Form -->
            <form id="scholarshipForm" class="form-container hidden">
                <!-- Hidden field to track scholarship type -->
                <input type="hidden" id="scholarshipType" name="scholarshipType" value="">
                <input type="hidden" id="verifiedEmail" name="verifiedEmail" value="">
                <input type="hidden" id="verifiedLocation" name="verifiedLocation" value="">
                
                <!-- Personal Information Section -->
                <div class="form-section">
                    <h3 class="section-title">Personal Information</h3>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="firstName">First Name <span class="required">*</span></label>
                            <input type="text" id="firstName" name="firstName" required>
                            <div class="error-text" id="firstName-error">Please enter your first name</div>
                        </div>
                        <div class="form-col">
                            <label for="lastName">Last Name <span class="required">*</span></label>
                            <input type="text" id="lastName" name="lastName" required>
                            <div class="error-text" id="lastName-error">Please enter your last name</div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="email">Email Address <span class="required">*</span></label>
                            <input type="email" id="email" name="email" required>
                            <div class="error-text" id="email-error">Please enter a valid email address</div>
                        </div>
                        <div class="form-col">
                            <label for="phone">Phone Number</label>
                            <input type="tel" id="phone" name="phone">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="country">Country <span class="required">*</span></label>
                            <select id="country" name="country" required>
                                <!-- Options will be dynamically populated by JavaScript -->
                                <option value="">Select your country</option>
                            </select>
                            <div class="error-text" id="country-error">Please select your country</div>
                        </div>
                        <div class="form-col">
                            <label for="city">City</label>
                            <input type="text" id="city" name="city">
                        </div>
                    </div>
                </div>

                <!-- Professional Background Section -->
                <div class="form-section">
                    <h3 class="section-title">Professional Background</h3>
                    
                    <div class="form-group">
                        <label for="organization">Current Organization/Institution <span class="required">*</span></label>
                        <input type="text" id="organization" name="organization" required>
                        <div class="error-text" id="organization-error">Please enter your organization</div>
                    </div>

                    <div class="form-row">
                        <div class="form-col">
                            <label for="position">Current Position/Role <span class="required">*</span></label>
                            <input type="text" id="position" name="position" required>
                            <div class="error-text" id="position-error">Please enter your position</div>
                        </div>
                        <div class="form-col">
                            <label for="experience">Years of Experience</label>
                            <select id="experience" name="experience">
                                <option value="">Select experience level</option>
                                <option value="0-1">0-1 years</option>
                                <option value="2-5">2-5 years</option>
                                <option value="6-10">6-10 years</option>
                                <option value="11-15">11-15 years</option>
                                <option value="16+">16+ years</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="sector">Primary Sector <span class="required">*</span></label>
                        <select id="sector" name="sector" required>
                            <option value="">Select your sector</option>
                            <option value="Journalism">Journalism</option>
                            <option value="Civil Society Organization">Civil Society Organization</option>
                            <option value="Non-Governmental Organization">Non-Governmental Organization</option>
                            <option value="Government">Government</option>
                            <option value="Academic/Research">Academic/Research</option>
                            <option value="International Development">International Development</option>
                            <option value="Policy Analysis">Policy Analysis</option>
                            <option value="Data Analysis">Data Analysis</option>
                            <option value="Other">Other</option>
                        </select>
                        <div class="error-text" id="sector-error">Please select your sector</div>
                    </div>
                </div>

                <!-- Education Section -->
                <div class="form-section">
                    <h3 class="section-title">Educational Background</h3>
                    
                    <div class="form-row">
                        <div class="form-col">
                            <label for="education">Highest Education Level <span class="required">*</span></label>
                            <select id="education" name="education" required>
                                <option value="">Select education level</option>
                                <option value="High School">High School</option>
                                <option value="Bachelor's Degree">Bachelor's Degree</option>
                                <option value="Master's Degree">Master's Degree</option>
                                <option value="Doctoral Degree">Doctoral Degree</option>
                                <option value="Professional Certificate">Professional Certificate</option>
                                <option value="Other">Other</option>
                            </select>
                            <div class="error-text" id="education-error">Please select your education level</div>
                        </div>
                        <div class="form-col">
                            <label for="fieldOfStudy">Field of Study</label>
                            <input type="text" id="fieldOfStudy" name="fieldOfStudy">
                        </div>
                    </div>
                </div>

                <!-- Course Interest Section -->
                <div class="form-section">
                    <h3 class="section-title">Course Interest & Motivation</h3>
                    
                    <div class="form-group">
                        <label for="motivation">Why are you interested in the Global Development Finance course? <span class="required">*</span></label>
                        <textarea id="motivation" name="motivation" required placeholder="Please describe your motivation for taking this course and how it aligns with your professional goals..."></textarea>
                        <div class="error-text" id="motivation-error">Please describe your motivation</div>
                    </div>

                    <div class="form-group">
                        <label for="experience_data">Do you have any prior experience with data analysis or journalism?</label>
                        <textarea id="experience_data" name="experience_data" placeholder="Please describe any relevant experience with data analysis, journalism, or development finance..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="expectations">What do you hope to achieve by completing this course? <span class="required">*</span></label>
                        <textarea id="expectations" name="expectations" required placeholder="Please describe your learning objectives and how you plan to apply the knowledge..."></textarea>
                        <div class="error-text" id="expectations-error">Please describe your expectations</div>
                    </div>
                </div>



                <!-- Additional Information Section -->
                <div class="form-section">
                    <h3 class="section-title">Additional Information</h3>
                    
                    <div class="form-group">
                        <label for="additional_info">Is there anything else you would like us to know about your application?</label>
                        <textarea id="additional_info" name="additional_info" placeholder="Any additional information that might support your scholarship application..."></textarea>
                    </div>

                    <div class="form-group">
                        <label for="hear_about">How did you hear about this scholarship opportunity?</label>
                        <select id="hear_about" name="hear_about">
                            <option value="">Please select</option>
                            <option value="AidData Website">AidData Website</option>
                            <option value="Email Newsletter">Email Newsletter</option>
                            <option value="Social Media">Social Media</option>
                            <option value="Colleague/Friend">Colleague/Friend</option>
                            <option value="Professional Network">Professional Network</option>
                            <option value="Academic Institution">Academic Institution</option>
                            <option value="Other">Other</option>
                        </select>
                    </div>
                </div>

                <!-- Terms and Conditions -->
                <div class="form-section">
                    <div class="checkbox-group">
                        <div class="checkbox-item">
                            <input type="checkbox" id="terms" name="terms" required>
                            <label for="terms">I agree to the terms and conditions and understand that scholarship decisions will be communicated within 2-3 weeks of application submission. <span class="required">*</span></label>
                        </div>
                        <div class="checkbox-item">
                            <input type="checkbox" id="privacy" name="privacy" required>
                            <label for="privacy">I consent to AidData processing my personal information for scholarship evaluation purposes. <span class="required">*</span></label>
                        </div>
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="submit-container">
                    <button type="submit" class="submit-btn" id="submitBtn">Submit Application</button>
                    <div class="loading" id="loading">Submitting your application...</div>
                    <div class="success-message" id="successMessage">
                        <strong>Application Submitted Successfully!</strong><br>
                        Thank you for your scholarship application. We have received your information and will review it carefully. You should expect to hear back from us within 2-3 weeks. A confirmation email has been sent to your provided email address.
                    </div>
                    <div class="error-message" id="errorMessage">
                        <strong>Submission Error</strong><br>
                        There was an error submitting your application. Please check your internet connection and try again. If the problem persists, please contact us directly at <a href="mailto:training@aiddata.org">training@aiddata.org</a>.
                    </div>
                </div>
            </form>
        </div>

        <!-- Footer -->
        <div class="footer">
            <p>Questions about the scholarship program?</p>
            <p>
                Email us at <a href="mailto:training@aiddata.org">training@aiddata.org</a> | 
                Visit our <a href="https://aiddata.org/training">website</a>
            </p>
            
            <div class="footer-divider"></div>
            
            <div>
                <a href="https://www.wm.edu">
                    <img src="https://cdn.prod.website-files.com/5914719ba6e62162556bd443/59d445067eedf20001205357_wm_vertical_single_line_white.png" alt="William & Mary" class="wm-logo" />
                </a>
            </div>
        </div>
    </div>

    <script>
        // Initialize EmailJS
        emailjs.init("tHLlMDU6cDEkdxBfg");

        // Global variables
        let selectedScholarshipType = '';
        let wmEmailVerified = false;
        let locationVerified = false;
        let verificationCode = '';
        let userLocation = null;

        // Initialize page
        document.addEventListener('DOMContentLoaded', function() {
            initializeScholarshipSelection();
            populateCountryDropdown();
        });

        // Populate country dropdown with all eligible Global South countries
        function populateCountryDropdown() {
            const countrySelect = document.getElementById('country');
            if (!countrySelect) return;

            // Clear existing options except the first one
            countrySelect.innerHTML = '<option value="">Select your country</option>';

            // Sort all Global South countries alphabetically
            const sortedCountries = allGlobalSouthCountries.sort();

            // Add each country as an option
            sortedCountries.forEach(country => {
                const option = document.createElement('option');
                option.value = country;
                option.textContent = country;
                countrySelect.appendChild(option);
            });

            // Add "Other" option at the end
            const otherOption = document.createElement('option');
            otherOption.value = 'Other';
            otherOption.textContent = 'Other';
            countrySelect.appendChild(otherOption);
        }

        // Scholarship selection functionality
        function initializeScholarshipSelection() {
            const scholarshipOptions = document.querySelectorAll('.scholarship-option');
            
            scholarshipOptions.forEach(option => {
                option.addEventListener('click', function() {
                    // Remove selected class from all options
                    scholarshipOptions.forEach(opt => opt.classList.remove('selected'));
                    
                    // Add selected class to clicked option
                    this.classList.add('selected');
                    
                    // Get scholarship type
                    selectedScholarshipType = this.dataset.type;
                    
                    // Show appropriate verification section
                    showVerificationSection(selectedScholarshipType);
                });
            });
        }

        function showVerificationSection(type) {
            // Hide scholarship selection
            document.getElementById('scholarshipSelection').style.display = 'none';
            
            // Hide all verification sections
            document.querySelectorAll('.verification-section').forEach(section => {
                section.classList.remove('active');
            });

            if (type === 'wm') {
                document.getElementById('wmVerification').classList.add('active');
                initializeWMVerification();
            } else if (type === 'global-south') {
                document.getElementById('globalSouthVerification').classList.add('active');
                initializeLocationVerification();
            }
        }

        // W&M Email Verification
        function initializeWMVerification() {
            const sendCodeBtn = document.getElementById('sendCodeBtn');
            const verifyCodeBtn = document.getElementById('verifyCodeBtn');
            const continueBtn = document.getElementById('continueWMBtn');
            const backBtn = document.getElementById('backFromWMBtn');

            sendCodeBtn.addEventListener('click', sendVerificationCode);
            verifyCodeBtn.addEventListener('click', verifyCode);
            continueBtn.addEventListener('click', showApplicationForm);
            backBtn.addEventListener('click', resetToScholarshipSelection);
        }

        async function sendVerificationCode() {
            const emailInput = document.getElementById('wmEmail');
            const email = emailInput.value.trim();
            const statusDiv = document.getElementById('wmEmailStatus');
            const sendBtn = document.getElementById('sendCodeBtn');

            // Validate W&M email
            if (!email || !email.endsWith('@wm.edu')) {
                showStatus(statusDiv, 'error', 'Please enter a valid @wm.edu email address.');
                return;
            }

            sendBtn.disabled = true;
            sendBtn.textContent = 'Sending...';

            try {
                // Generate 6-digit verification code
                verificationCode = Math.floor(100000 + Math.random() * 900000).toString();
                
                // Send verification email using EmailJS
                await emailjs.send(
                    'service_fg5k8q8', // Your EmailJS service ID
                    'template_03qvsva', // W&M verification template ID
                    {
                        to_email: email,
                        to_name: 'W&M Community Member',
                        from_name: 'AidData Training Team',
                        verification_code: verificationCode,
                        message: `Your verification code is: ${verificationCode}`
                    }
                );

                showStatus(statusDiv, 'success', 'Verification code sent! Please check your email.');
                document.getElementById('codeVerificationStep').style.display = 'block';
                
            } catch (error) {
                console.error('Error sending verification code:', error);
                showStatus(statusDiv, 'error', 'Failed to send verification code. Please try again.');
            }

            sendBtn.disabled = false;
            sendBtn.textContent = 'Send Code';
        }

        function verifyCode() {
            const codeInput = document.getElementById('verificationCode');
            const code = codeInput.value.trim();
            const statusDiv = document.getElementById('codeStatus');
            const continueBtn = document.getElementById('continueWMBtn');

            if (code === verificationCode) {
                wmEmailVerified = true;
                showStatus(statusDiv, 'success', 'Email verified successfully!');
                continueBtn.style.display = 'block';
                
                // Store verified email
                document.getElementById('verifiedEmail').value = document.getElementById('wmEmail').value;
            } else {
                showStatus(statusDiv, 'error', 'Invalid verification code. Please try again.');
            }
        }

        // Global South Location Verification
        function initializeLocationVerification() {
            checkUserLocation();
            document.getElementById('continueGSBtn').addEventListener('click', showApplicationForm);
            document.getElementById('backFromGSBtn').addEventListener('click', resetToScholarshipSelection);
        }

        async function checkUserLocation() {
            const statusDiv = document.getElementById('locationCheckStatus');
            const resultsDiv = document.getElementById('locationResults');
            const continueBtn = document.getElementById('continueGSBtn');

            try {
                // Use multiple IP geolocation services for reliability
                const locationData = await getLocationData();
                
                if (!locationData) {
                    throw new Error('Unable to determine location');
                }

                userLocation = locationData;
                
                // Display location information
                document.getElementById('detectedCountry').textContent = locationData.country;
                document.getElementById('detectedCity').textContent = locationData.city;
                resultsDiv.style.display = 'block';

                // Check if country is in Global South
                const isGlobalSouth = allGlobalSouthCountries.includes(locationData.country);
                
                // Check for VPN indicators
                const vpnRisk = await checkVPNRisk(locationData);

                if (vpnRisk.isVPN) {
                    showStatus(statusDiv, 'error', 
                        `VPN usage detected. To ensure program integrity, VPN usage is not permitted during the application process. Please disable your VPN and refresh the page.`
                    );
                    return;
                }

                if (!isGlobalSouth) {
                    showStatus(statusDiv, 'error', 
                        `Your location (${locationData.country}) is not eligible for the Global South scholarship program. Please select the W&M Affiliation scholarship if you are affiliated with William & Mary.`
                    );
                    setTimeout(() => {
                        resetToScholarshipSelection();
                    }, 5000);
                    return;
                }

                // Success - eligible location
                locationVerified = true;
                showStatus(statusDiv, 'success', 
                    `Location verified! You are eligible for the Global South scholarship program.`
                );
                continueBtn.style.display = 'block';
                
                // Store verified location
                document.getElementById('verifiedLocation').value = `${locationData.city}, ${locationData.country}`;

            } catch (error) {
                console.error('Location verification error:', error);
                showStatus(statusDiv, 'error', 
                    'Unable to verify your location. Please check your internet connection and try again.'
                );
            }
        }

        async function getLocationData() {
            // Try multiple geolocation services
            const services = [
                'https://ipapi.co/json/',
                'https://ipinfo.io/json',
                'https://api.ipgeolocation.io/ipgeo?apiKey=YOUR_API_KEY' // Replace with actual API key if needed
            ];

            for (const service of services) {
                try {
                    const response = await fetch(service);
                    const data = await response.json();
                    
                    // Normalize response format
                    if (data.country_name || data.country) {
                        return {
                            country: data.country_name || data.country,
                            city: data.city || data.region || 'Unknown',
                            ip: data.ip,
                            timezone: data.timezone,
                            org: data.org || data.isp
                        };
                    }
                } catch (error) {
                    console.log(`Service ${service} failed:`, error);
                    continue;
                }
            }
            
            return null;
        }

        async function checkVPNRisk(locationData) {
            // Simple VPN detection heuristics
            const vpnIndicators = {
                isVPN: false,
                risk: 0,
                indicators: []
            };

            // Check for common VPN/proxy indicators in organization name
            const vpnKeywords = ['vpn', 'proxy', 'hosting', 'datacenter', 'cloud', 'server', 'tunnel'];
            const org = (locationData.org || '').toLowerCase();
            
            for (const keyword of vpnKeywords) {
                if (org.includes(keyword)) {
                    vpnIndicators.indicators.push(`Suspicious organization: ${locationData.org}`);
                    vpnIndicators.risk += 0.3;
                }
            }

            // Additional checks could be added here with specialized VPN detection APIs
            
            if (vpnIndicators.risk > 0.5) {
                vpnIndicators.isVPN = true;
            }

            return vpnIndicators;
        }

        function showApplicationForm() {
            // Hide verification sections
            document.querySelectorAll('.verification-section').forEach(section => {
                section.classList.remove('active');
            });

            // Set scholarship type in hidden field
            document.getElementById('scholarshipType').value = selectedScholarshipType;

            // Show application form
            document.getElementById('scholarshipForm').classList.remove('hidden');
            
            // Update form title based on scholarship type
            const formTitle = selectedScholarshipType === 'wm' ? 
                'W&M Affiliation Scholarship Application' : 
                'Global South Scholarship Application';
            
            // Scroll to form
            document.getElementById('scholarshipForm').scrollIntoView({ behavior: 'smooth' });
        }

        function resetToScholarshipSelection() {
            // Hide all sections
            document.querySelectorAll('.verification-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById('scholarshipForm').classList.add('hidden');
            
            // Show scholarship selection
            document.getElementById('scholarshipSelection').style.display = 'block';
            
            // Reset selection
            document.querySelectorAll('.scholarship-option').forEach(opt => 
                opt.classList.remove('selected')
            );
            
            // Reset variables
            selectedScholarshipType = '';
            wmEmailVerified = false;
            locationVerified = false;
            verificationCode = '';
            userLocation = null;
            
            // Clear W&M verification form
            document.getElementById('wmEmail').value = '';
            document.getElementById('verificationCode').value = '';
            document.getElementById('wmEmailStatus').innerHTML = '';
            document.getElementById('codeStatus').innerHTML = '';
            document.getElementById('codeVerificationStep').style.display = 'none';
            document.getElementById('continueWMBtn').style.display = 'none';
            document.getElementById('sendCodeBtn').disabled = false;
            document.getElementById('sendCodeBtn').textContent = 'Send Code';
            
            // Clear Global South verification
            document.getElementById('locationCheckStatus').innerHTML = '<div class="status-message status-info"><strong>Checking your location...</strong><br>Please wait while we verify your geographic location and check for VPN usage.</div>';
            document.getElementById('locationResults').style.display = 'none';
            document.getElementById('continueGSBtn').style.display = 'none';
            
            // Clear hidden form fields
            document.getElementById('scholarshipType').value = '';
            document.getElementById('verifiedEmail').value = '';
            document.getElementById('verifiedLocation').value = '';
            
            // Scroll back to top
            document.getElementById('scholarshipSelection').scrollIntoView({ behavior: 'smooth' });
        }

        function showStatus(element, type, message) {
            element.innerHTML = `<div class="status-message status-${type}">${message}</div>`;
        }

        // Form validation functions
        function validateEmail(email) {
            const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
            return re.test(email);
        }

        function validateField(field) {
            const value = field.value.trim();
            const fieldName = field.name;
            const errorElement = document.getElementById(fieldName + '-error');
            
            let isValid = true;
            let errorMessage = '';

            // Check if required field is empty
            if (field.hasAttribute('required') && !value) {
                isValid = false;
                errorMessage = 'This field is required';
            }
            
            // Specific validation for email
            if (fieldName === 'email' && value && !validateEmail(value)) {
                isValid = false;
                errorMessage = 'Please enter a valid email address';
            }

            // Show/hide error
            if (isValid) {
                field.classList.remove('invalid');
                if (errorElement) errorElement.style.display = 'none';
            } else {
                field.classList.add('invalid');
                if (errorElement) {
                    errorElement.textContent = errorMessage;
                    errorElement.style.display = 'block';
                }
            }

            return isValid;
        }

        // Add real-time validation
        document.addEventListener('DOMContentLoaded', function() {
            document.querySelectorAll('input, select, textarea').forEach(field => {
                field.addEventListener('blur', () => validateField(field));
                field.addEventListener('input', () => {
                    if (field.classList.contains('invalid')) {
                        validateField(field);
                    }
                });
            });
        });

        // Form submission
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('scholarshipForm').addEventListener('submit', async function(e) {
                e.preventDefault();

                // Validate all fields
                let isFormValid = true;
                const requiredFields = this.querySelectorAll('[required]');
                
                requiredFields.forEach(field => {
                    if (!validateField(field)) {
                        isFormValid = false;
                    }
                });

                if (!isFormValid) {
                    // Scroll to first invalid field
                    const firstInvalid = this.querySelector('.invalid');
                    if (firstInvalid) {
                        firstInvalid.scrollIntoView({ behavior: 'smooth', block: 'center' });
                        firstInvalid.focus();
                    }
                    return;
                }

                // Prepare form data
                const formData = new FormData(this);
                const data = {};
                for (let [key, value] of formData.entries()) {
                    data[key] = value;
                }

                // Show loading state
                const submitBtn = document.getElementById('submitBtn');
                const loading = document.getElementById('loading');
                const successMessage = document.getElementById('successMessage');
                const errorMessage = document.getElementById('errorMessage');

                submitBtn.disabled = true;
                loading.style.display = 'block';
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';

                try {
                    // Send internal notification to training team
                    await emailjs.send(
                        'service_fg5k8q8',
                        'template_b8otaj6',
                        {
                            user_email: 'training@aiddata.org',
                            to_email: 'training@aiddata.org',
                            from_name: data.firstName + ' ' + data.lastName,
                            from_email: data.email,
                            reply_to: data.email,
                            subject: `AidData Scholarship Application - ${data.firstName} ${data.lastName}`,
                            
                            // Scholarship Information
                            scholarship_type: data.scholarshipType === 'wm' ? 'W&M Affiliation' : 'Global South',
                            verified_email: data.verifiedEmail || 'N/A',
                            verified_location: data.verifiedLocation || 'N/A',
                            
                            // Personal Information
                            first_name: data.firstName,
                            last_name: data.lastName,
                            email: data.email,
                            phone: data.phone || 'Not provided',
                            country: data.country,
                            city: data.city || 'Not provided',
                            
                            // Professional Background
                            organization: data.organization,
                            position: data.position,
                            experience: data.experience || 'Not specified',
                            sector: data.sector,
                            
                            // Education
                            education: data.education,
                            field_of_study: data.fieldOfStudy || 'Not provided',
                            
                            // Course Interest
                            motivation: data.motivation,
                            experience_data: data.experience_data || 'None specified',
                            expectations: data.expectations,
                            
                            // Additional Information
                            additional_info: data.additional_info || 'None provided',
                            hear_about: data.hear_about || 'Not specified',
                            
                            // Timestamp
                            submission_date: new Date().toLocaleString()
                        }
                    );

                    // Send confirmation email to user
                    await emailjs.send(
                        'service_fg5k8q8',
                        'template_xvb981w',
                        {
                            user_email: data.email,
                            to_email: data.email,
                            from_name: 'AidData Training Team',
                            reply_to: 'training@aiddata.org',
                            subject: 'Scholarship Application Confirmation',
                            
                            // User-relevant information only
                            first_name: data.firstName,
                            last_name: data.lastName,
                            country: data.country,
                            current_position: data.currentPosition,
                            organization: data.organization,
                            submission_date: new Date().toLocaleString()
                        }
                    );

                    // Show success message
                    loading.style.display = 'none';
                    successMessage.style.display = 'block';
                    this.reset();
                    successMessage.scrollIntoView({ behavior: 'smooth' });

                } catch (error) {
                    console.error('Error sending email:', error);
                    
                    // Show error message
                    loading.style.display = 'none';
                    errorMessage.style.display = 'block';
                    submitBtn.disabled = false;
                    errorMessage.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Smooth scrolling for anchor links
        document.querySelectorAll('a[href^="#"]').forEach(anchor => {
            anchor.addEventListener('click', function (e) {
                e.preventDefault();
                const target = document.querySelector(this.getAttribute('href'));
                if (target) {
                    target.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });
    </script>
</body>
</html>
